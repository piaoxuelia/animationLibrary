
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>内网统一登录nodejs版本</title>
    <!-- Bootstrap core CSS -->
    <link href="./static/module/bootstrap/css/bootstrap.css" rel="stylesheet">
 
    <link href="./static/module/highlight/styles/github.css" rel="stylesheet">
    <style type="text/css" media="screen">
    body{
      background: ;
    }
    ul{padding-left: 20px;}
    b{color:#333;}
    h2{
      padding-top: 10px;
    }
    body{
      font-size: 16px;
    }
    </style>
  
  
	

    <script src="./static/module/jquery/1.9.1/jquery.js"></script>
    <script src="./static/module/bootstrap/js/bootstrap.js"></script>
    
  

  </head>

  <body>


    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
        <div class="col-md-12" style="padding-bottom:40px;">
            <h1 style="font-size:48px;">内网统一登录nodejs版本</h1>
            <p>内网统一登录是内网系统下的一种认证方式，比如：考勤，代码发布系统等很多内部系统都使用该认证方式</p>
            <p>nodejs版本的实现接口基本和PHP版本一致，nodejs版本的包名为<code>uuap</code></p>
            <h2>获取代码</h2>
            <pre><code>git clone git@10.16.57.39:75team/projects/uuap.git</code></pre>
            <ul>
              <li>如果你没有权限拉取，请联系<code>heshuo@360.cn</code>，飞信号为：<code>634308262</code></li>
              <li>由于该代码涉及内部的一些安全信息，所以不能发布到npm包管理系统里</li>
              <li>将下载的包拷贝到<code>node_modules</code>目录下</li>
              <li>进入uuap目录，执行<code>npm install</code>，安装依赖</li>
            </ul>
            <h2>如何使用</h2>
            <h3>获取用户信息</h3>
            <pre><code>uuap.getUserInfo(req, res) //如果没有登录跳转到登录页</code></pre>
            <pre><code>uuap.getUserInfo(req, res, false) //如果没有登录不跳转到登录页</code></pre>
            <p>req, res为创建server后传递的request和response对象，具体可以参考下面的例子。</p>
            <h3>退出</h3>
            <pre><code>uuap.logout()</code></pre>
            具体例子：
            <pre><code class="language-js">var querystring = require("querystring");
var url = require("url");

//加载uuap
var uuap = require("uuap");

require("http").createServer(function (req, res) {
  if (req.url == '/favicon.ico') {
    res.end();
    return;
  };
  res.setHeader("Content-Type", "text/html;charset=utf-8");
  
  var urlInfo = url.parse("//" + req.headers.host + req.url, true, true);
  var query = urlInfo.query;
  if (query.force) {
    //通过getUserInfo接口获取用户信息, 如果没有登录则强制跳转到登录页面
    //返回一个promise
    uuap.getUserInfo(req, res).then(function(userInfo){
      res.write("&lt;h1&gt;登录信息为：&lt;/h1&gt;", "utf-8");
      res.write(JSON.stringify(userInfo, undefined, 4), "utf-8");
      res.write('&lt;br&gt;&lt;br&gt;&lt;a href="?logout=1"&gt;退出&lt;/a&gt;', "utf-8");
      res.end();
    })
  }else if(query.logout){
    //退出
    uuap.logout(req, res);
    res.statusCode = 302;
    res.setHeader("Location", "/");
    res.end();
  }else{
    //通过getUserInfo接口获取用户信息，如果没有登录useInfo为空
    //返回一个promise
    uuap.getUserInfo(req, res, false).then(function(userInfo){
      if (Object.keys(userInfo).length == 0) {
        res.write("尚未登录");
        res.write('&lt;br&gt;&lt;br&gt;&lt;a href="?force=1"&gt;点击登录&lt;/a&gt;')
      }else{
        res.write("&lt;h1&gt;登录信息为：&lt;/h1&gt;");
        res.write(JSON.stringify(userInfo, undefined, 4), "utf-8");
        res.write('&lt;br&gt;&lt;br&gt;&lt;a href="?logout=1"&gt;退出&lt;/a&gt;', "utf-8");
      }
      res.end();
    })
  }
}).listen(9527);</code></pre>
            <p>getUserInfo接口需要传入req和res 2个对象，默认情况下如果没有登录自动跳转到登录页面。</p>
            <p>如果不想自动跳转的话，可以传入第3个参数为<code>false</code></p>
            
            <h2>在线DEMO</h2>
            <a target="_blank" href="http://www.qiwoo.org:9527/" class="btn btn-primary">不强制登录</a>

            <a target="_blank" href="http://www.qiwoo.org:9527/?force=1" class="btn btn-primary">强制登录</a>

            <h2>反馈</h2>
            <p>联系<code>lichengyin@360.cn</code>，飞信号: <code>989209160</code></p>

            <h2>使用案例</h2>
            <p>期待你的使用...</p>
        </div>
      </div>
    </div>
  <script src="./static/module/highlight/highlight.pack.js"></script>
  <script >hljs.initHighlightingOnLoad();</script>
  </body>
</html>
