{
    "version": 3,
    "sources": [
        "../../../src/user/controller/edit.js"
    ],
    "names": [],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;;;;;;;;;;;kBAOO,W;;OAGD,I,EAEC,M;;;;;;cAFY,KAAK,WAAL,CAAiB,IAAjB,C;;;AAAb,W;;YACD,I;;;;;AACE,a,GAAS,KAAK,GAAL,CAAS,QAAT,C;;AACb,YAAK,MAAL,CAAY;AACX,cAAK,UADM;AAEX,eAAM,MAFK;AAGX,gBAAO,MAHI;AAIX,cAAK;AAJM,QAAZ;;wCAOO,KAAK,OAAL,E;;;;;;;;;;;;;;;;;;;kBAIH,U;;OACD,S,EACA,S,EACA,M,EAEA,M,EAEA,M;;;;;AANA,gB,GAAY,KAAK,KAAL,CAAW,MAAX,C;AACZ,gB,GAAY,KAAK,KAAL,CAAW,MAAX,C;AACZ,a,GAAS,KAAK,KAAL,CAAW,SAAX,C;AAET,a,GAAS,KAAK,GAAL,CAAS,QAAT,C;AAET,a,GAAO,E;;cACS,UAAU,MAAV,E;;;AAApB,cAAO,I;;cACiB,UAAU,KAAV,CAAgB,EAAC,QAAO,MAAR,EAAhB,EAAiC,MAAjC,E;;;AAAxB,cAAO,Q;;cACiB,OAAO,KAAP,CAAa,EAAC,QAAO,MAAR,EAAb,EAA8B,MAA9B,E;;;AAAxB,cAAO,Q;;;AAEP,YAAK,OAAL,CAAa,EAAE,UAAU,MAAZ,EAAb;;;;;;;;;;;;;;;;;;;;kBAIK,gB;;OACD,M,EACA,M,EACA,M,EACA,I,EAMC,I;;;;;;AATD,a,GAAS,KAAK,KAAL,CAAW,SAAX,C;AACT,a,GAAS,KAAK,GAAL,CAAS,QAAT,C;AACT,a,GAAS,KAAK,GAAL,CAAS,QAAT,C;AACT,W,GAAO,KAAK,GAAL,CAAS,MAAT,C;;;;;aAKR,QAAQ,C;;;;;;cACO,OAAO,KAAP,CAAa,EAAC,QAAO,MAAR,EAAb,EAA8B,GAA9B,CAAkC,KAAlC,C;;;AAAb,W;;AACJ,cAAO,GAAP,CAAW;AACV,gBAAQ,MADE;AAEV,gBAAO,MAFG;AAGV,aAAI,OAAK;AAHC,QAAX;;;;;AAKK,WAAG,QAAQ,CAAX,EAAa;;AAClB,eAAO,KAAP,CAAa,EAAC,QAAO,MAAR,EAAe,QAAO,MAAtB,EAAb,EAA4C,MAA5C;AACA,aAAK,OAAL,CAAa,EAAE,UAAU,SAAO,MAAP,GAAc,SAAd,GAAyB,IAAzB,GAA8B,SAA9B,GAAwC,MAApD,EAAb;AACA;;;;;;;;;;;;;;;;;;;kBAKI,W;;OACD,S,EAEA,M,EACA,Q,EACA,G,EACA,M,EACA,O,EACA,K;;;;;AAPA,gB,GAAY,KAAK,KAAL,CAAW,MAAX,C;AAEZ,a,GAAS,KAAK,GAAL,CAAS,QAAT,C;AACT,e,GAAW,KAAK,GAAL,CAAS,UAAT,C;AACX,U,GAAM,KAAK,GAAL,CAAS,KAAT,C;AACN,a,GAAS,KAAK,GAAL,CAAS,QAAT,C;AACT,c,GAAU,KAAK,GAAL,CAAS,SAAT,C;AACV,Y,GAAQ,KAAK,GAAL,CAAS,OAAT,C;;;cAGL,UAAU,KAAV,CAAgB,EAAC,QAAO,MAAR,EAAhB,EAAiC,MAAjC,CAAwC;AAC7C,kBAAU,QADmC;AAE7C,gBAAO,MAFsC;AAG7C,aAAK,GAHwC;AAI7C,iBAAQ,OAJqC;AAK7C,eAAM;AALuC,QAAxC,C;;;;AAQN,YAAK,OAAL,CAAa,EAAE,UAAS,MAAX,EAAb;;;;;;;;AAEA,YAAK,IAAL,CAAU,GAAV,EAAe,KAAf",
    "file": "../../../src/user/controller/edit.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n\t/**\n\t * index action\n\t * @return {Promise} []\n\t */\n\tasync indexAction() {\n\n\t\t//auto render template file index_index.html\n\t\tlet user = await this.checkAuthor(this);\n\t\tif(user){\n\t\t\tlet toolId = this.get('toolId');\n\t\t\tthis.assign({ \n\t\t\t\tpage:\"edittool\",\n\t\t\t\ttitle:\"编辑工具\",\n\t\t\t\ttoolId:toolId,\n\t\t\t\tuser:user\n\t\t\t})\n\n\t\t\treturn this.display();\n\t\t}\n\t}\n\t//获取当前工具的信息，返回到客户端进行展示\n\tasync editAction(){\n\t\tlet modelCate = this.model(\"CATE\");\n\t\tlet modelList = this.model(\"LIST\");\n\t\tlet coList = this.model(\"CONNECT\");\n\n\t\tlet toolId = this.get('toolId');\n\n\t\tlet result={};\n\t\tresult.cate = await modelCate.select();\n\t\tresult.listData = await modelList.where({toolId:toolId}).select();\n\t\tresult.connData = await coList.where({toolId:toolId}).select();\n\n\t\tthis.success({ \"result\": result });\n\t}\n\n\t// 更新工具分类\n\tasync updatecateAction(){\n\t\tlet coList = this.model(\"CONNECT\");\n\t\tlet toolId = this.get('toolId');\n\t\tlet cateId = this.get('cateId');\n\t\tlet type = this.get('type');\n\n\t\t// type:1 为工具增加分类\n\t\t// type:2 在connect 表中删除此工具的此分类\n\t\t\n\t\tif(type == 1){//添加\n\t\t\tvar _num = await coList.where({cateId:cateId}).max(\"num\");\n\t\t\tcoList.add({\n\t\t\t\ttoolId: toolId,\n\t\t\t\tcateId:cateId,\n\t\t\t\tnum:_num+1\n\t\t\t});\n\t\t}else if(type == 2){//删除\n\t\t\tcoList.where({toolId:toolId,cateId:cateId}).delete();\n\t\t\tthis.success({ \"result\": \"tid:\"+toolId+\"  type:\"+ type+\"cateId:\"+cateId});\n\t\t}\n\t}\n\n\t//存储编辑后的信息到list表\n\n\tasync storeAction() {\n\t\tlet modelList = this.model(\"LIST\");\n\n\t\tlet toolId = this.get('toolId');\n\t\tlet toolName = this.get('toolName');\n\t\tlet url = this.get('url');\n\t\tlet imgUrl = this.get('imgUrl');\n\t\tlet profile = this.get('profile');\n\t\tlet email = this.get('email');\n\n\t\ttry{\n\t\t\tawait modelList.where({toolId:toolId}).update({\n\t\t\t\ttoolName: toolName,\n\t\t\t\timgUrl:imgUrl,\n\t\t\t\turl: url, \n\t\t\t\tprofile:profile,\n\t\t\t\temail:email\n\t\t\t});\n\n\t\t\tthis.success({ \"result\":\"更改成功\"});\n\t\t}catch(e){\n\t\t\tthis.fail(102, \"未成功\");\n\t\t}\n\t\t\n\n\t}\n\t\n}"
    ]
}