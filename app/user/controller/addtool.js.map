{
    "version": 3,
    "sources": [
        "../../../src/user/controller/addtool.js"
    ],
    "names": [],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;;;;;;;;;;;kBAOO,W;;OAED,I;;;;;;cAAa,KAAK,WAAL,CAAiB,IAAjB,C;;;AAAb,W;;YACD,I;;;;;AACF,YAAK,MAAL,CAAY;AACX,cAAK,SADM;AAEX,eAAM,MAFK;AAGX,cAAK;AAHM,QAAZ;wCAKO,KAAK,OAAL,E;;;;;;;;;;;;;;;;;kBAKH,a;;OACD,K,EAEC,M;;;;;AAFD,Y,GAAQ,KAAK,KAAL,CAAW,MAAX,C;;;cAEQ,MAAM,MAAN,E;;;AAAf,a;;AACJ,YAAK,OAAL,CAAa,EAAE,UAAU,MAAZ,EAAb;;;;;;;;AAEA,YAAK,IAAL,CAAU,GAAV,EAAe,KAAf;;;;;;;;;;;;;;;;;kBAKI,W;;;;OACD,S,EACA,M,EAEA,Q,EACA,G,EACA,M,EACA,O,EACA,M,EACA,K,EAOC,M,EACA,G,EAEA,G,EAGI,C;;;;;AArBL,gB,GAAY,KAAK,KAAL,CAAW,MAAX,C;AACZ,a,GAAS,KAAK,KAAL,CAAW,SAAX,C;AAET,e,GAAW,KAAK,GAAL,CAAS,UAAT,C;AACX,U,GAAM,KAAK,GAAL,CAAS,KAAT,C;AACN,a,GAAS,KAAK,GAAL,CAAS,QAAT,C;AACT,c,GAAU,KAAK,GAAL,CAAS,SAAT,C;AACV,a,GAAS,KAAK,GAAL,CAAS,QAAT,C;AACT,Y,GAAQ,KAAK,GAAL,CAAS,OAAT,C;;;;;AAOP,a,GAAS,E;AACT,U,GAAM,OAAO,KAAP,CAAa,GAAb,C;;cAEM,UAAU,KAAV,CAAgB,EAAC,KAAI,GAAL,EAAhB,EAA2B,KAA3B,E;;;AAAZ,U;AAGI,Q,GAAE,C;;;aAAG,IAAE,IAAI,M;;;;;;cACD,OAAO,KAAP,CAAa,EAAC,QAAO,IAAI,CAAJ,CAAR,EAAb,EAA8B,GAA9B,CAAkC,KAAlC,C;;;AAAjB,cAAO,CAAP,C;;;AAD0B,U;;;;;WAIvB,G;;;;;;YAEC,Q;;;;;;mBAAiB,UAAU,GAAV,CAAc;AAClC,uBAAU,QADwB;AAElC,qBAAO,MAF2B;AAGlC,kBAAK,GAH6B;AAIlC,sBAAQ,OAJ0B;AAKlC,oBAAM;AAL4B,aAAd,C;;;AAAjB,oB;;;;AASJ,gBAAI,OAAJ,CAAY,UAAS,IAAT,EAAc,CAAd,EAAgB;AAC3B,oBAAO,GAAP,CAAW;AACV,sBAAQ,QADE;AAEV,sBAAO,IAFG;AAGV,mBAAI,OAAO,CAAP,IAAU;AAHJ,cAAX;AAKA,aAND;AAOA,mBAAK,OAAL,CAAa,EAAE,UAAS,MAAX,EAAb;;;;;;;;;;;;;;;AAEA,YAAK,IAAL,CAAU,GAAV,EAAe,OAAf;;;;;;;;;;AAID,YAAK,IAAL,CAAU,GAAV,EAAe,KAAf",
    "file": "../../../src/user/controller/addtool.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n\t/**\n\t * index action\n\t * @return {Promise} []\n\t */\n\tasync indexAction() {\n\t\t//auto render template file index_index.html\n\t\tlet user = await this.checkAuthor(this);\n\t\tif(user){\n\t\t\tthis.assign({ \n\t\t\t\tpage:\"addtool\",\n\t\t\t\ttitle:\"添加工具\",\n\t\t\t\tuser:user\n\t\t\t})\n\t\t\treturn this.display();\n\t\t}\n\t\t\n\t}\n\n\tasync getcateAction() {\n\t\tlet model = this.model(\"CATE\");\n\t\ttry {\n\t\t\tlet result = await model.select();\n\t\t\tthis.success({ \"result\": result });\n\t\t} catch (e) {\n\t\t\tthis.fail(102, \"未成功\");\n\t\t}\n\t}\n\n\n\tasync storeAction() {\n\t\tlet modelList = this.model(\"LIST\");\n\t\tlet coList = this.model(\"CONNECT\");\n\t\t\n\t\tvar toolName = this.get('toolName');\n\t\tvar url = this.get('url');\n\t\tvar imgUrl = this.get('imgUrl');\n\t\tvar profile = this.get('profile');\n\t\tvar cateId = this.get('cateId');\n\t\tvar email = this.get('email');\n\n\n\n\n\t\t//将得到的数据参数存储LIST中，获取toolId,并将分类信息存到CONNECT表中 将审核表中相应的记录删除\n\t\ttry {\n\t\t\tvar arrNum = [];\n\t\t\tvar arr = cateId.split(',');\n\n\t\t\tlet num = await modelList.where({url:url}).count();\n\n\t\t\n\t\t\tfor(var i=0; i<arr.length; i++){\n\t\t\t\tarrNum[i] =await coList.where({cateId:arr[i]}).max(\"num\");\n\t\t\t}\n\n\t\t\tif(!num){\n\t\t\t\t/* 将记录插入到LIST表中 */\n\t\t\t\tlet insertId = await modelList.add({\n\t\t\t\t\ttoolName: toolName,\n\t\t\t\t\timgUrl:imgUrl,\n\t\t\t\t\turl: url, \n\t\t\t\t\tprofile:profile,\n\t\t\t\t\temail:email\n\t\t\t\t});\n\n\t\t\t\t/* 将记录插入到CONNECT表中 并将默认将 */\n\t\t\t\tarr.forEach(function(item,i){\n\t\t\t\t\tcoList.add({\n\t\t\t\t\t\ttoolId: insertId,\n\t\t\t\t\t\tcateId:item,\n\t\t\t\t\t\tnum:arrNum[i]+1\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\tthis.success({ \"result\":arrNum});\n\t\t\t}else{\n\t\t\t\tthis.fail(102, \"记录已存在\");\n\t\t\t}\n\n\t\t} catch (e) {\n\t\t\tthis.fail(102, \"未成功\");\n\t\t}\n\t}\n}"
    ]
}